<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</title>
    <style>
        /* –í–°–ï –°–¢–ò–õ–ò –û–°–¢–ê–Æ–¢–°–Ø –¢–ê–ö–ò–ú–ò –ñ–ï –ö–ê–ö –í –ü–†–ï–î–´–î–£–©–ï–ô –í–ï–†–°–ò–ò */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --secondary-gradient: linear-gradient(135deg, #667eea, #764ba2);
            --danger-gradient: linear-gradient(135deg, #ff6b6b, #ee5a52);
            --success-gradient: linear-gradient(135deg, #4ecdc4, #44a08d);
            --gray-gradient: linear-gradient(135deg, #a0aec0, #718096);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: #333;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-container {
            background: white;
            border-radius: 16px;
            padding: 30px 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 24px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: #718096;
            font-size: 14px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .btn-primary {
            background: var(--secondary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-logout {
            background: var(--danger-gradient);
            color: white;
            padding: 8px 16px;
            font-size: 13px;
            width: auto;
            position: absolute;
            top: 15px;
            right: 15px;
        }

        .admin-container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 16px;
            padding: 20px 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            position: relative;
            display: none;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f3f4;
            padding-right: 80px;
        }

        .header h1 {
            font-size: clamp(20px, 4vw, 28px);
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .header p {
            color: #718096;
            font-size: clamp(12px, 3vw, 14px);
        }

        .stats {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .stat-card {
            background: var(--secondary-gradient);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 140px;
            flex: 1;
            max-width: 200px;
        }

        .stat-number {
            font-size: clamp(20px, 5vw, 28px);
            font-weight: bold;
            margin-bottom: 6px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.9;
        }

        .form-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-title {
            font-size: clamp(16px, 4vw, 18px);
            font-weight: 600;
            margin-bottom: 15px;
            color: #2d3748;
        }

        .btn-secondary {
            background: var(--gray-gradient);
            color: white;
            margin-right: 10px;
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
            padding: 8px 12px;
            font-size: 13px;
            flex: 1;
        }

        .btn-edit {
            background: var(--success-gradient);
            color: white;
            padding: 8px 12px;
            font-size: 13px;
            flex: 1;
            margin-right: 8px;
        }

        .products-list {
            margin-top: 20px;
        }

        .product-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            flex-direction: column;
        }

        .product-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .product-main {
            display: flex;
            width: 100%;
            margin-bottom: 12px;
            align-items: flex-start;
        }

        .product-image {
            width: 60px;
            height: 60px;
            border-radius: 6px;
            object-fit: cover;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .product-info {
            flex: 1;
            min-width: 0;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2d3748;
            font-size: 15px;
            line-height: 1.3;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-order {
            color: #4a5568;
            font-size: 12px;
            background: #e2e8f0;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-right: 8px;
            font-weight: 600;
        }

        .product-url {
            color: #667eea;
            font-size: 13px;
            text-decoration: none;
            word-break: break-all;
            display: block;
            margin-top: 5px;
        }

        .product-actions {
            display: flex;
            width: 100%;
            gap: 8px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f1f3f4;
            border-radius: 10px;
            padding: 4px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: clamp(12px, 3vw, 14px);
            min-width: 120px;
        }

        .tab.active {
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 14px;
        }

        .alert-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .alert-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        .alert-warning {
            background: #feebc8;
            color: #744210;
            border: 1px solid #fbd38d;
        }

        .loading {
            text-align: center;
            padding: 30px 15px;
            color: #a0aec0;
        }

        .loading-spinner {
            width: 25px;
            height: 25px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .form-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .cancel-edit {
            display: none;
            background: var(--gray-gradient);
            color: white;
            flex: 1;
        }

        .cancel-edit.show {
            display: flex;
        }

        .edit-mode {
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        .login-credentials {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 12px;
            color: #718096;
            text-align: left;
        }

        .login-credentials strong {
            color: #2d3748;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
                min-height: 100vh;
            }

            .login-container {
                margin-top: 20px;
                padding: 25px 20px;
            }

            .admin-container {
                padding: 15px 10px;
                margin-top: 10px;
            }

            .header {
                padding-right: 70px;
                margin-bottom: 20px;
            }

            .btn-logout {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 12px;
            }

            .form-section {
                padding: 15px;
            }

            .product-item {
                padding: 12px;
            }

            .product-main {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .product-image {
                width: 80px;
                height: 80px;
                margin-right: 0;
                margin-bottom: 10px;
            }

            .product-info {
                width: 100%;
            }

            .product-actions {
                flex-direction: column;
                gap: 6px;
            }

            .btn-edit, .btn-danger {
                width: 100%;
                margin-right: 0;
            }

            .tabs {
                flex-direction: column;
                gap: 4px;
            }

            .tab {
                min-width: auto;
            }

            .stats {
                flex-direction: column;
                align-items: center;
            }

            .stat-card {
                max-width: 100%;
                width: 100%;
            }
        }

        @media (max-width: 360px) {
            .login-container {
                padding: 20px 15px;
            }

            .admin-container {
                padding: 10px 8px;
            }

            .form-section {
                padding: 12px;
            }

            .product-item {
                padding: 10px;
            }

            .btn {
                padding: 10px 15px;
                font-size: 14px;
            }

            .header h1 {
                font-size: 18px;
            }

            .header p {
                font-size: 11px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .admin-container {
                max-width: 90%;
                padding: 25px 20px;
            }

            .product-item {
                flex-direction: row;
                align-items: center;
            }

            .product-main {
                flex: 1;
                margin-bottom: 0;
                margin-right: 15px;
            }

            .product-actions {
                width: auto;
                flex-direction: column;
                min-width: 150px;
            }
        }

        @media (min-width: 1025px) {
            .admin-container {
                padding: 30px 25px;
            }

            .products-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                align-items: start;
            }

            .form-section {
                margin-bottom: 0;
            }

            .tab-content.active {
                display: grid;
                grid-template-columns: 1fr;
                gap: 20px;
            }

            #addTab.tab-content.active {
                grid-template-columns: 1fr;
            }

            #manageTab.tab-content.active {
                grid-template-columns: 1fr;
            }

            .product-item {
                flex-direction: row;
                align-items: center;
            }

            .product-main {
                flex: 1;
                margin-bottom: 0;
                margin-right: 20px;
            }

            .product-actions {
                width: auto;
                min-width: 180px;
            }

            .form-actions {
                flex-wrap: nowrap;
            }

            .cancel-edit {
                flex: 0 0 auto;
                width: auto;
                min-width: 120px;
            }
        }

        @media (min-width: 1440px) {
            .admin-container {
                max-width: 1400px;
            }

            .products-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (prefers-color-scheme: dark) {
            .login-container, .admin-container {
                background: #2d3748;
                color: #e2e8f0;
            }

            .form-section {
                background: #4a5568;
            }

            .form-input {
                background: #4a5568;
                border-color: #718096;
                color: #e2e8f0;
            }

            .form-input:focus {
                border-color: #667eea;
            }

            .form-label {
                color: #e2e8f0;
            }

            .product-item {
                background: #4a5568;
                color: #e2e8f0;
            }

            .product-name {
                color: #e2e8f0;
            }

            .tabs {
                background: #4a5568;
            }

            .tab.active {
                background: #667eea;
                color: white;
            }
        }

        @supports(padding: max(0px)) {
            body {
                padding-left: max(10px, env(safe-area-inset-left));
                padding-right: max(10px, env(safe-area-inset-right));
                padding-top: max(10px, env(safe-area-inset-top));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ -->
    <div class="login-container" id="loginContainer">
        <div class="login-icon">üîê</div>
        <h1 class="login-title">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <p class="login-subtitle">–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞</p>
        
        <form id="loginForm">
            <div class="form-group">
                <label class="form-label">–õ–æ–≥–∏–Ω</label>
                <input type="text" class="form-input" id="login" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω" required>
            </div>

            <div class="form-group">
                <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" class="form-input" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            </div>

            <button type="submit" class="btn btn-primary" id="loginBtn">
                üîë –í–æ–π—Ç–∏
            </button>
        </form>
        
        <div class="login-credentials">
            <strong>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</strong><br>
            –õ–æ–≥–∏–Ω: <code>admin</code><br>
            –ü–∞—Ä–æ–ª—å: <code>Wave_2_0_2_5!</code>
        </div>
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—Å–∫—Ä—ã—Ç–∞ –¥–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) -->
    <div class="admin-container" id="adminContainer">
        <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
        <button class="btn btn-logout" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>

        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>‚ö° –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p>–£–ø—Ä–∞–≤–ª—è–π —Ç–æ–≤–∞—Ä–∞–º–∏ –¥–ª—è Wildberries –∫–∞—Ç–∞–ª–æ–≥–∞</p>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalProducts">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</div>
            </div>
        </div>

        <!-- –¢–∞–±—ã -->
<div class="tabs">
    <div class="tab active" onclick="showTab('add')">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</div>
    <div class="tab" onclick="showTab('manage')">üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</div>
    <div class="tab" onclick="showTab('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤</div>
</div>

<!-- –ù–æ–≤—ã–π —Ç–∞–± –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
<div id="statsTab" class="tab-content">
    <div class="form-section">
        <h3 class="form-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤</h3>
        
        <!-- –ü–µ—Ä–∏–æ–¥ –≤—ã–±–æ—Ä–∫–∏ -->
        <div class="form-group">
            <label class="form-label">–ü–µ—Ä–∏–æ–¥:</label>
            <select class="form-input" id="statsPeriod" onchange="loadStatistics()">
                <option value="day">–ó–∞ —Å–µ–≥–æ–¥–Ω—è</option>
                <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
            </select>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
        <div class="form-actions" style="margin-bottom: 20px;">
            <button class="btn btn-secondary" onclick="exportStats('csv')">
                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
            </button>
            <button class="btn btn-primary" onclick="exportStats('excel')">
                üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
            </button>
        </div>
        
        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-summary" id="statsSummary" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalClicks">0</div>
                <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalProductsWithClicks">0</div>
                <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤ —Å –∫–ª–∏–∫–∞–º–∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgClicksPerProduct">0</div>
                <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –Ω–∞ —Ç–æ–≤–∞—Ä</div>
            </div>
        </div>
        
        <!-- –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div id="statsTableContainer">
            <div class="loading" id="statsLoading">
                <div class="loading-spinner"></div>
                <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
        </div>
    </div>
</div>

<style>
/* –î–æ–±–∞–≤—å—Ç–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.stats-table th {
    background: #f8fafc;
    padding: 12px 15px;
    text-align: left;
    font-weight: 600;
    color: #4a5568;
    border-bottom: 2px solid #e2e8f0;
}

.stats-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #e2e8f0;
}

.stats-table tr:hover {
    background: #f7fafc;
}

.stats-table .product-name {
    font-weight: 500;
    color: #2d3748;
}

.stats-table .clicks-count {
    font-weight: 600;
    color: #805ad5;
}

.stats-table .percentage {
    color: #718096;
    font-size: 13px;
}

.stats-summary {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
}
</style>

<script>
// –î–æ–±–∞–≤—å—Ç–µ –≤ JavaScript –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function loadStatistics() {
    const period = document.getElementById('statsPeriod').value;
    const container = document.getElementById('statsTableContainer');
    
    container.innerHTML = `
        <div class="loading" id="statsLoading">
            <div class="loading-spinner"></div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
        </div>
    `;
    
    try {
        const result = await apiRequest('getStats', { period: period });
        
        if (result.status === 'success') {
            displayStatistics(result.data);
        } else {
            throw new Error(result.data);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
        container.innerHTML = `
            <div class="alert alert-error">
                –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}
            </div>
        `;
    }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function displayStatistics(stats) {
    const container = document.getElementById('statsTableContainer');
    const summaryContainer = document.getElementById('statsSummary');
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ —Å –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
    summaryContainer.style.display = 'flex';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    document.getElementById('totalClicks').textContent = stats.totalClicks || 0;
    document.getElementById('totalProductsWithClicks').textContent = stats.products.length || 0;
    
    const avgClicks = stats.products.length > 0 ? 
        (stats.totalClicks / stats.products.length).toFixed(1) : 0;
    document.getElementById('avgClicksPerProduct').textContent = avgClicks;
    
    if (!stats.products || stats.products.length === 0) {
        container.innerHTML = `
            <div class="alert alert-warning">
                –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∫–ª–∏–∫–∞—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
            </div>
        `;
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
    let tableHTML = `
        <table class="stats-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö–ª–∏–∫–æ–≤</th>
                    <th>–ü—Ä–æ—Ü–µ–Ω—Ç</th>
                    <th>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º</th>
                </tr>
            </thead>
            <tbody>
    `;
    
    stats.products.forEach((product, index) => {
        const percentage = stats.totalClicks > 0 ? 
            ((product.clicks / stats.totalClicks) * 100).toFixed(1) + '%' : '0%';
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–Ω–µ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
        let dailyStats = '';
        if (product.dailyClicks && Object.keys(product.dailyClicks).length > 0) {
            const days = Object.entries(product.dailyClicks)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ø-3 –¥–Ω—è
            
            dailyStats = days.map(([date, clicks]) => 
                `${date}: ${clicks}`
            ).join('<br>');
        }
        
        tableHTML += `
            <tr>
                <td>${index + 1}</td>
                <td class="product-name">${product.name}</td>
                <td class="clicks-count">${product.clicks}</td>
                <td class="percentage">${percentage}</td>
                <td style="font-size: 12px; color: #718096;">${dailyStats || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</td>
            </tr>
        `;
    });
    
    tableHTML += `
            </tbody>
        </table>
        <div style="margin-top: 15px; color: #718096; font-size: 13px;">
            <strong>–ü–µ—Ä–∏–æ–¥:</strong> ${stats.period === 'day' ? '–ó–∞ —Å–µ–≥–æ–¥–Ω—è' : stats.period === 'week' ? '–ó–∞ –Ω–µ–¥–µ–ª—é' : '–ó–∞ –º–µ—Å—è—Ü'} 
            (${new Date(stats.startDate).toLocaleDateString('ru-RU')} - ${new Date(stats.endDate).toLocaleDateString('ru-RU')})
        </div>
    `;
    
    container.innerHTML = tableHTML;
}

// –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
async function exportStats(format) {
    const period = document.getElementById('statsPeriod').value;
    
    try {
        const result = await apiRequest('exportStats', { 
            period: period, 
            format: format 
        });
        
        if (result.status === 'success') {
            if (format === 'csv') {
                // –°–∫–∞—á–∏–≤–∞–µ–º CSV —Ñ–∞–π–ª
                const blob = new Blob([result.data.content], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = result.data.filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('‚úÖ CSV —Ñ–∞–π–ª –≥–æ—Ç–æ–≤ –∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏—é');
            } else if (format === 'excel') {
                showAlert(`‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ª–∏—Å—Ç: ${result.data.sheetName}`);
            }
        } else {
            throw new Error(result.data);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
        showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
    }
}

// –í —Ñ—É–Ω–∫—Ü–∏–∏ showTab –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
function showTab(tabName) {
    if (!isAuthenticated) return;
    
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
    
    document.querySelectorAll('.tab')[tabName === 'add' ? 0 : tabName === 'manage' ? 1 : 2].classList.add('active');
    document.getElementById(tabName + 'Tab').classList.add('active');
    
    if (tabName === 'manage') {
        loadProducts();
    } else if (tabName === 'stats') {
        loadStatistics();
    }
}

// –í —Ñ—É–Ω–∫—Ü–∏–∏ renderProducts –æ—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤
function renderProducts() {
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ ...
    
    productsList.innerHTML = sortedProducts.map(product => `
        <div class="product-item">
            <div class="product-main">
                <img src="${product.image}" alt="${product.name}" class="product-image"
                     onerror="this.src='https://via.placeholder.com/70x70/e2e8f0/64748b?text=üì¶'">
                <div class="product-info">
                    <div class="product-name">
                        <span class="product-order">${product.order || 999}</span>
                        ${product.name}
                    </div>
                    <div style="color: #718096; font-size: 12px; margin-top: 4px;">
                        üëÜ –ö–ª–∏–∫–æ–≤: <strong>${product.clicks || 0}</strong>
                    </div>
                    <a href="${product.url}" target="_blank" class="product-url" onclick="event.stopPropagation()">
                        ${product.url.length > 50 ? product.url.substring(0, 50) + '...' : product.url}
                    </a>
                </div>
            </div>
            <div class="product-actions">
                <button class="btn btn-edit" onclick="editProduct('${product.id}')">
                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
                <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
    `).join('');
}
</script>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="alertContainer"></div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="products-grid">
            <!-- –¢–∞–±: –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä -->
            <div id="addTab" class="tab-content active">
                <div class="form-section" id="productFormSection">
                    <h3 class="form-title" id="formTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä</h3>
                    <form id="addProductForm">
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                            <input type="text" class="form-input" id="productName" 
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: iPhone 15 Pro Max 256GB" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ *</label>
                            <input type="url" class="form-input" id="productImage" 
                                   placeholder="https://example.com/image.jpg" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ Wildberries *</label>
                            <input type="url" class="form-input" id="productUrl" 
                                   placeholder="https://www.wildberries.ru/catalog/..." required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ *</label>
                            <input type="number" class="form-input" id="productOrder" 
                                   placeholder="1 (–ø–µ—Ä–≤—ã–π –≤ —Å–ø–∏—Å–∫–µ)" required min="1" value="1">
                            <small style="color: #718096; font-size: 12px; margin-top: 4px; display: block;">
                                –ß–µ–º –º–µ–Ω—å—à–µ —á–∏—Å–ª–æ, —Ç–µ–º –≤—ã—à–µ —Ç–æ–≤–∞—Ä –≤ —Å–ø–∏—Å–∫–µ
                            </small>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary cancel-edit" id="cancelEdit" onclick="cancelEdit()">
                                ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                            </button>
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                ‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –¢–∞–±: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ -->
            <div id="manageTab" class="tab-content">
                <div class="form-section">
                    <h3 class="form-title">–í—Å–µ —Ç–æ–≤–∞—Ä—ã (—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É)</h3>
                    <div class="products-list" id="productsList">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üîê –î–ê–ù–ù–´–ï –î–õ–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        const ADMIN_CREDENTIALS = {
            login: 'admin',
            password: 'Wave_2_0_2_5!'
        };

        // üî• –í–ê–® URL GOOGLE APPS SCRIPT API
        const API_URL = 'https://script.google.com/macros/s/AKfycbxtFV_dB-8e32ghmgI5YBBKX5M0eTekHq1EvDvnUhMdnZSv6TRE9xHTxGEk9o7TUfx6pA/exec';

        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ç–æ–≤–∞—Ä–æ–≤
        let products = [];
        let editingProductId = null;
        let isAuthenticated = false;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const loginContainer = document.getElementById('loginContainer');
        const adminContainer = document.getElementById('adminContainer');
        const loginForm = document.getElementById('loginForm');
        const addProductForm = document.getElementById('addProductForm');
        const productsList = document.getElementById('productsList');
        const totalProducts = document.getElementById('totalProducts');
        const alertContainer = document.getElementById('alertContainer');
        const submitBtn = document.getElementById('submitBtn');
        const cancelEditBtn = document.getElementById('cancelEdit');
        const formTitle = document.getElementById('formTitle');
        const productFormSection = document.getElementById('productFormSection');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function checkAuth() {
            const savedAuth = localStorage.getItem('adminAuth');
            if (savedAuth === 'true') {
                isAuthenticated = true;
                showAdminPanel();
            } else {
                showLoginForm();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –ª–æ–≥–∏–Ω–∞
        function showLoginForm() {
            loginContainer.style.display = 'block';
            adminContainer.style.display = 'none';
            isAuthenticated = false;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        function showAdminPanel() {
            loginContainer.style.display = 'none';
            adminContainer.style.display = 'block';
            isAuthenticated = true;
            loadProducts();
            showAlert('üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å!', 'success');
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        function logout() {
            localStorage.removeItem('adminAuth');
            isAuthenticated = false;
            showLoginForm();
            loginForm.reset();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const login = document.getElementById('login').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (login === ADMIN_CREDENTIALS.login && password === ADMIN_CREDENTIALS.password) {
                localStorage.setItem('adminAuth', 'true');
                showAdminPanel();
            } else {
                showAlert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error', loginContainer);
            }
        });

        // API —Ñ—É–Ω–∫—Ü–∏–∏
        async function apiRequest(action, params = {}) {
            try {
                const urlParams = new URLSearchParams({ action, ...params });
                const response = await fetch(API_URL, {
                    method: 'POST',
                    body: urlParams
                });
                return await response.json();
            } catch (error) {
                console.error('API Error:', error);
                return { status: 'error', data: error.toString() };
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä—ã
        async function loadProducts() {
            if (!isAuthenticated) return;
            
            try {
                productsList.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</div>
                    </div>
                `;

                const result = await apiRequest('getProducts');
                if (result.status === 'success') {
                    products = result.data;
                    updateStats();
                    renderProducts();
                } else {
                    throw new Error(result.data);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showAlert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤: ' + error.message, 'error');
                productsList.innerHTML = '<div style="text-align: center; padding: 30px; color: #a0aec0;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showAlert(message, type = 'success', container = alertContainer) {
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function updateStats() {
            totalProducts.textContent = products.length;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–±
        function showTab(tabName) {
            if (!isAuthenticated) return;
            
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab:nth-child(${tabName === 'add' ? 1 : 2})`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'manage') {
                loadProducts();
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        async function saveProduct(productData) {
            if (!isAuthenticated) return false;
            
            try {
                submitBtn.disabled = true;
                
                // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º addProduct, –¥–∞–∂–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                // –ù–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º—ã —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å —Å–Ω–∞—á–∞–ª–∞
                if (editingProductId) {
                    submitBtn.textContent = '‚è≥ –û–±–Ω–æ–≤–ª—è–µ–º...';
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π —Ç–æ–≤–∞—Ä
                    await deleteProductSilently(editingProductId);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å —Ç–µ–º –∂–µ ID
                    const result = await apiRequest('addProduct', {
                        id: editingProductId,
                        name: productData.name,
                        image: productData.image,
                        url: productData.url,
                        order: parseInt(productData.order) || 1
                    });
                    
                    if (result.status === 'success') {
                        await loadProducts();
                        showAlert('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                        cancelEdit();
                        return true;
                    } else {
                        throw new Error(result.data);
                    }
                } else {
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
                    submitBtn.textContent = '‚è≥ –î–æ–±–∞–≤–ª—è–µ–º...';
                    
                    const result = await apiRequest('addProduct', {
                        id: 'product_' + Date.now(),
                        name: productData.name,
                        image: productData.image,
                        url: productData.url,
                        order: parseInt(productData.order) || 1
                    });
                    
                    if (result.status === 'success') {
                        await loadProducts();
                        showAlert('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                        addProductForm.reset();
                        document.getElementById('productOrder').value = 1;
                        return true;
                    } else {
                        throw new Error(result.data);
                    }
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: ' + error.message, 'error');
                return false;
            } finally {
                submitBtn.disabled = false;
                updateSubmitButton();
            }
        }

        // –¢–∏—Ö–∏–π —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
        async function deleteProductSilently(productId) {
            try {
                const result = await apiRequest('deleteProduct', { id: productId });
                return result.status === 'success';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏:', error);
                return false;
            }
        }

        // –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)
        async function deleteProduct(productId) {
            if (!isAuthenticated) return;
            
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
                try {
                    const result = await apiRequest('deleteProduct', { id: productId });
                    
                    if (result.status === 'success') {
                        await loadProducts();
                        showAlert('‚úÖ –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');
                    } else {
                        throw new Error(result.data);
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞: ' + error.message, 'error');
                }
            }
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä
        function editProduct(productId) {
            if (!isAuthenticated) return;
            
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('productName').value = product.name;
                document.getElementById('productImage').value = product.image;
                document.getElementById('productUrl').value = product.url;
                document.getElementById('productOrder').value = product.order || 1;
                
                editingProductId = productId;
                
                formTitle.textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
                productFormSection.classList.add('edit-mode');
                cancelEditBtn.classList.add('show');
                updateSubmitButton();
                
                showTab('add');
                
                showAlert('–¢–æ–≤–∞—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é. –ò–∑–º–µ–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"');
            }
        }

        // –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function cancelEdit() {
            editingProductId = null;
            addProductForm.reset();
            document.getElementById('productOrder').value = 1;
            formTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä';
            productFormSection.classList.remove('edit-mode');
            cancelEditBtn.classList.remove('show');
            updateSubmitButton();
            showAlert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        function updateSubmitButton() {
            if (editingProductId) {
                submitBtn.textContent = '‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            } else {
                submitBtn.textContent = '‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
        function renderProducts() {
            if (!isAuthenticated) return;
            
            if (products.length === 0) {
                productsList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #a0aec0;">
                        <div style="font-size: 40px; margin-bottom: 12px;">üì¶</div>
                        <div>–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</div>
                        <div style="font-size: 12px; margin-top: 6px; opacity: 0.7;">
                            –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä –≤–æ –≤–∫–ª–∞–¥–∫–µ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä"
                        </div>
                    </div>
                `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º —Ç–æ–≤–∞—Ä—ã –ø–æ –ø–æ—Ä—è–¥–∫—É
            const sortedProducts = [...products].sort((a, b) => {
                const orderA = parseInt(a.order) || 999;
                const orderB = parseInt(b.order) || 999;
                return orderA - orderB;
            });

            productsList.innerHTML = sortedProducts.map(product => `
                <div class="product-item">
                    <div class="product-main">
                        <img src="${product.image}" alt="${product.name}" class="product-image"
                             onerror="this.src='https://via.placeholder.com/70x70/e2e8f0/64748b?text=üì¶'">
                        <div class="product-info">
                            <div class="product-name">
                                <span class="product-order">${product.order || 999}</span>
                                ${product.name}
                            </div>
                            <a href="${product.url}" target="_blank" class="product-url" onclick="event.stopPropagation()">
                                ${product.url.length > 50 ? product.url.substring(0, 50) + '...' : product.url}
                            </a>
                        </div>
                    </div>
                    <div class="product-actions">
                        <button class="btn btn-edit" onclick="editProduct('${product.id}')">
                            ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        <button class="btn btn-danger" onclick="deleteProduct('${product.id}')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
        addProductForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!isAuthenticated) return;
            
            const productData = {
                name: document.getElementById('productName').value.trim(),
                image: document.getElementById('productImage').value.trim(),
                url: document.getElementById('productUrl').value.trim(),
                order: document.getElementById('productOrder').value.trim()
            };

            if (!productData.name || !productData.image || !productData.url || !productData.order) {
                showAlert('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            if (isNaN(productData.order) || parseInt(productData.order) < 1) {
                showAlert('‚ùå –ü–æ—Ä—è–¥–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ 0', 'error');
                return;
            }

            await saveProduct(productData);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
        });
    </script>
</body>
</html>




